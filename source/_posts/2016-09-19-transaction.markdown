---
layout: post
title: "分布式事务，也谈"
date: 2016-09-19 17:16:43 +0800
comments: true
categories: ["架构"]
published: true

---

近来有挺多文章谈“分布式事务”。
这些文章主要是从实现模式角度来谈的。比如常见的模式有哪些，哪些个模式适合哪种场景，有什么优点缺点，根据什么选择等等。比如附图的这个红绿灯图[^1]，是其中的优秀代表。很有指导作用。

这个“也谈”不重复，从其他角度谈一些认识：

<!--more-->

### 一

“分布式事务”到底是什么？

1. 分布式事务本质上是对一个过程进行管理。
2. 这个过程由一些操作构成，特别是由一些容易出问题的操作构成。
3. 管理者的职责是尽量调用这些操作。
4. 管理者的职责是做出决策。当某些操作成功或失败时其他操作如何处置。
5. 管理者可能顺便也要处理，各个操作的依赖如何安排，结果如何聚合。

### 二

为了完成管理的职责，管理者必须清楚操作的特性：

1. 操作结果是否可知？如何可知？
2. 操作可否重试，如何重试？
3. 操作可否撤销，如何撤销？
3. 操作结果是否可以“外界”可见？

### 三

为了完成管理职责，管理者需要有一套决策规则，例如 - 

First Header  | Second Header
------------- | -------------


### 四
常见的所有实现模式，都是对上述要点的实现。-

1. Saga - 最为一般的模型
2. 补偿 - 简化的模型，一般用于处理顺序执行的操作，一旦某个操作失败，补偿已经成功的操作。
4. TCC - 可以做到在事务过程中外界对操作不可见，也就是做到“隔离性”，这个特性的代价是把一个操作人为地分为两个。
5. 可靠事件 - 可靠事件模式并非是一个完整的管理，只是管理者调用操作的途径。这个途径的底层机制决定了管理者可以假定操作总会成功（或者就当它都成功了）。所以对过程的管理就可以比较简单了。
6. 两段、三段 - 




{% img  /images/transaction/transaction.jpg 500 %}

[^1]: 原文：[分布式事务：不过是在一致性、吞吐量和复杂度之间，做一个选择](http://www.open-open.com/lib/view/open1473404638516.html)